{% extends "base.html" %}

{% block content %}
<h1>Créer une nouvelle tâche</h1>
<form method="POST">
    {{ form.hidden_tag() }}  <!-- CSRF protection -->

    <div class="form-group">
        {{ form.name.label }}
        {{ form.name(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.source.label }}
        {{ form.source(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.destination.label }}
        {{ form.destination(class="form-control") }}
    </div>

    {{ form.submit(class="btn btn-primary") }}
</form>
        <!-- New Replication Options -->
        <div class="card mb-3">
            <div class="card-header">Replication Options</div>
            <div class="card-body">
                <div class="mb-3">
                    {{ form.replication_mode.label }}
                    {{ form.replication_mode(class="form-select") }}
                </div>

                <div id="tables-section" class="mb-3"
                     style="display: {% if form.replication_mode.data == 'partial' %}block{% else %}none{% endif %}">
                    {{ form.tables.label }}
                    {{ form.tables(class="form-control", rows=4,
                        placeholder="Enter table names separated by commas\nExample: users,products,orders") }}
                    <small class="form-text text-muted">
                        Leave empty to replicate all tables
                    </small>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            {{ form.initial_load(class="form-check-input") }}
                            {{ form.initial_load.label(class="form-check-label") }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            {{ form.create_tables(class="form-check-input") }}
                            {{ form.create_tables.label(class="form-check-label") }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{{ url_for('web.dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
document.getElementById('replication_mode').addEventListener('change', function() {
    document.getElementById('tables-section').style.display =
        this.value === 'partial' ? 'block' : 'none';
});
</script>
{% endblock %}